<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>Crawler &#8212; MYCELIUM  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=83e35b93" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css?v=79c92029" />
    <link rel="stylesheet" type="text/css" href="../_static/_style.css?v=a28cf678" />
    <link rel="stylesheet" type="text/css" href="../_static/_style.css?v=a28cf678" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=white data-md-color-accent=black>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#_modules/Crawler" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="MYCELIUM  documentation"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">MYCELIUM</span>
          <span class="md-header-nav__topic"> Crawler </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder=""Search""
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">MYCELIUM  documentation</a></li>
          <li class="md-tabs__item"><a href="index.html" class="md-tabs__link">Module code</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="MYCELIUM documentation" class="md-nav__button md-logo">
      
        <img src="../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="MYCELIUM documentation">MYCELIUM</a>
  </label>
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">INTRODUCTION</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../Guide/purpose.html" class="md-nav__link">1. Statement of Purpose</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../Guide/guidelines.html" class="md-nav__link">2. Rules and Procedure</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../Guide/chain-of-command.html" class="md-nav__link">3. Chain of Command</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">GUIDE</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../Guide/ci-cd.html" class="md-nav__link">1. CI-CD Procedures</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../Guide/kubeflow.html" class="md-nav__link">2. Getting Started with Kubeflow</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../Guide/dashboard.html" class="md-nav__link">3. Platform Introduction Tutorial</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">EXAMPLES</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../Examples/notebooks.html" class="md-nav__link">1. Create a Kubeflow Notebook</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../Examples/katib.html" class="md-nav__link">2. Optimize Parameters</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../Examples/tensorboards.html" class="md-nav__link">3. Visualize Train and Test Results</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../Examples/plot-overview.html" class="md-nav__link">4. Plotting</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">REFERENCES</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../References/Mycelium.html" class="md-nav__link">Mycelium.py</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">database/</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../References/Mycelium/Inchworm.html" class="md-nav__link">Inchworm.py</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../References/Mycelium/Tree.html" class="md-nav__link">Tree.py</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../References/Mycelium/Branch.html" class="md-nav__link">Branch.py</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../References/Mycelium/Crawler.html" class="md-nav__link">Crawler.py</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">models/</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../References/Mycelium/Hyphae.html" class="md-nav__link">Hyphae.py</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../References/Mycelium/LLAMA.html" class="md-nav__link">LLAMA.py</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../References/Mycelium/Psilocybin.html" class="md-nav__link">Psilocybin.py</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">analytics/</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../References/Mycelium/Plot.html" class="md-nav__link">Plot.py</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../References/Mycelium/Cap.html" class="md-nav__link">Cap.py</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
  <ul class="md-nav__list" data-md-scrollfix="">
    

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <h1 id="modules-crawler--page-root">Source code for Crawler</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">csv</span><span class="o">,</span> <span class="nn">random</span><span class="o">,</span> <span class="nn">requests</span><span class="o">,</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">threading</span><span class="o">,</span> <span class="nn">concurrent.futures</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># test</span>
<span class="kn">from</span> <span class="nn">mycelium.utils</span> <span class="kn">import</span> <span class="p">(</span><span class="n">performance</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">observe</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>


<div class="viewcode-block" id="URL">
<a class="viewcode-back" href="../References/Mycelium/Crawler.html#Crawler.URL">[docs]</a>
<span class="k">class</span> <span class="nc">URL</span><span class="p">:</span>            
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">meta_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">num_threads</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        URL Initialize the class with a max_depth parameter. This is the maximum depth of the tree that will be crawled. The default value is 2.</span>

<span class="sd">        This class represents a hybrid neural network and graphDB object. It is custom suited to meet our needs for high-performance computing (HPC) systems where the neural network and the hardware network are tightly integrated. In this way, it is not strictly a Graph class or a machine learning class, but rather a glue that holds it all together.</span>
<span class="sd">          </span>
<span class="sd">          :param data: The data to be stored in the graph.</span>
<span class="sd">          :param meta_data: The metadata to be stored in the graph.</span>

<span class="sd">          :example:</span>
<span class="sd">          &gt;&gt;&gt; data = { "urls": { "id" :0 , "url" : "http://</span>
<span class="sd">          &gt;&gt;&gt; meta_data = { "urls": { "id" :0 , "url" : "http://</span>
<span class="sd">          &gt;&gt;&gt; instance = URL(data, meta_data)</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_depth</span> <span class="o">=</span> <span class="n">max_depth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_threads</span> <span class="o">=</span> <span class="n">num_threads</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_data</span> <span class="o">=</span> <span class="n">meta_data</span> <span class="c1"># TODO need to put meta data loading here</span>

    <span class="nd">@performance</span><span class="o">.</span><span class="n">timeit</span>
    <span class="k">def</span> <span class="nf">check_url_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">urls</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">			A method to check if a URL exists in your database. This can be used to avoid duplicate entries or to verify that a specific page has been crawled.</span>

<span class="sd">			:param urls: A list of URLs to check.</span>
<span class="sd">			:param parallel: Whether to run the URL checks in parallel. Defaults to False.</span>
<span class="sd">			:returns: A list of booleans indicating whether each URL exists in your database.</span>

<span class="sd">			:example:</span>

<span class="sd">			&gt;&gt;&gt; urls = ['https://www.google.com', 'https://www.facebook.com']</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">parallel</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
                <span class="n">results</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">executor</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url_exists</span><span class="p">,</span> <span class="n">urls</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">url_exists</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="nd">@performance</span><span class="o">.</span><span class="n">timeit</span>
    <span class="k">def</span> <span class="nf">html_to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">html</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">			Convert html format into json format. To use this method we are calling "http://199.88.191.194:5008" server. </span>
<span class="sd">				</span>
<span class="sd">			:param html: The html passed in the function is a string representing html format from which you want to retrieve the json content.</span>
<span class="sd">			:returns: JSON represented as a Python dict.</span>

<span class="sd">			:example:</span>

<span class="sd">			&gt;&gt;&gt; html = '&lt;h1&gt;Hello World&lt;/h1&gt;'</span>
<span class="sd">			&gt;&gt; data.html_to_json(html)</span>
<span class="sd">        """</span>
        <span class="n">request_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_data</span><span class="p">[</span><span class="s2">"node_base_url"</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"/html-to-json"</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Authorization"</span><span class="p">:</span> <span class="s2">"25hD6Fpava"</span><span class="p">,</span>  <span class="s2">"Content-Type"</span><span class="p">:</span> <span class="s2">"application/json"</span><span class="p">}</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span> 
            <span class="s2">"html"</span><span class="p">:</span> <span class="n">html</span>
        <span class="p">})</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">request_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">'message'</span> <span class="ow">in</span> <span class="n">res</span><span class="p">):</span>
                <span class="k">return</span>  <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">'message'</span><span class="p">])</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>
            
    <span class="nd">@performance</span><span class="o">.</span><span class="n">timeit</span>
    <span class="k">def</span> <span class="nf">json_to_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsonData</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">			Convert json format into html format. </span>
<span class="sd">				</span>
<span class="sd">			:param jsonData: A string representing json format from which you want to</span>
<span class="sd">				retrieve the html content.</span>
<span class="sd">			:returns: HTML corresponding to the input.</span>

<span class="sd">			:example:</span>

<span class="sd">			&gt;&gt;&gt; data = { "urls": { "id" :0 , "url" : "http://199.88.191.194:5008"  } }   </span>
<span class="sd">			&gt;&gt;&gt; data.json_to_html(data)</span>

<span class="sd">			res = instance.json_to_html(data)</span>
<span class="sd">        """</span>
        <span class="c1"># TODO: this needs to be done on local</span>

        <span class="n">request_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_data</span><span class="p">[</span><span class="s2">"node_base_url"</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"/json-to-html"</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Authorization"</span><span class="p">:</span> <span class="s2">"25hD6Fpava"</span><span class="p">,</span>  <span class="s2">"Content-Type"</span><span class="p">:</span> <span class="s2">"application/json"</span><span class="p">}</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span> 
            <span class="s2">"json"</span><span class="p">:</span> <span class="n">jsonData</span>
        <span class="p">})</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">request_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">'message'</span> <span class="ow">in</span> <span class="n">res</span><span class="p">):</span>
            <span class="k">return</span>  <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">'message'</span><span class="p">])</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>

    <span class="nd">@performance</span><span class="o">.</span><span class="n">timeit</span>
    <span class="k">def</span> <span class="nf">url_to_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">			Get html of a given url.</span>
<span class="sd">			To use this method we are calling 'http://199.88.191.194:5008' server.</span>
<span class="sd">			It will convert the given url's html into our html format.</span>

<span class="sd">			:param url: Web URL from which you want to retrieve the HTML content.</span>
<span class="sd">			:returns: HTML off the URL.</span>

<span class="sd">			:example:</span>
<span class="sd">				</span>
<span class="sd">			&gt;&gt;&gt; URL= 'https://dev-cloud.virtuousai.com/meta.json'</span>
<span class="sd">			&gt;&gt;&gt; data.get_url_to_html(URL)</span>
<span class="sd">        """</span>
        <span class="n">request_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_data</span><span class="p">[</span><span class="s2">"node_base_url"</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"/convert?url="</span><span class="o">+</span><span class="n">url</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">request_url</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">'message'</span> <span class="ow">in</span> <span class="n">res</span><span class="p">):</span>
            <span class="k">return</span>  <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">'message'</span><span class="p">])</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>
        
        <span class="c1"># Generate WWW using multiple threads</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">URL</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">96</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">WWW</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">executor</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">url_to_html</span><span class="p">,</span> <span class="p">[</span><span class="n">url</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span></div>





<div class="viewcode-block" id="WarcIndexer">
<a class="viewcode-back" href="../References/Mycelium/Crawler.html#Crawler.WarcIndexer">[docs]</a>
<span class="k">class</span> <span class="nc">WarcIndexer</span><span class="p">:</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span class="w">    </span><span class="sd">"""Constructs all the necessary attributes for the Inchworm object.</span>
<span class="sd">        </span>
<span class="sd">    :param base_url: The base URL of the Common Crawl index</span>
<span class="sd">    :param indices: A list of indices currently available in the Common Crawl index</span>

<span class="sd">    :example:</span>

<span class="sd">    &gt;&gt;&gt; instance = Inchworm()</span>
<span class="sd">    """</span>

    <span class="c1"># Connect S3 (Need to get indexers)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'http'</span><span class="p">:</span> <span class="s1">'http://10.10.1.10:3128'</span><span class="p">,</span>
        <span class="s1">'https'</span><span class="p">:</span> <span class="s1">'http://10.10.1.10:1080'</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span> <span class="o">=</span> <span class="s1">'commoncrawl'</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">'s3'</span><span class="p">,</span>
                           <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">'ACCESSKEY'</span><span class="p">),</span> 
                           <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">'SECRET'</span><span class="p">),</span>
                            <span class="c1">#    config=botocore.config.Config(proxies=self.proxies)</span>
                               <span class="p">)</span>
      

    <span class="bp">self</span><span class="o">.</span><span class="n">indexers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_local_indexers</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">local_storage_path</span> <span class="o">=</span> <span class="s1">''</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">indexer_url</span> <span class="o">=</span> <span class="s1">'http://index.commoncrawl.org/collinfo.json'</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_warc_url</span> <span class="o">=</span> <span class="s1">'http://data.commoncrawl.org/'</span>
        
<div class="viewcode-block" id="WarcIndexer.check_remote_update">
<a class="viewcode-back" href="../References/Mycelium/Crawler.html#Crawler.WarcIndexer.check_remote_update">[docs]</a>
  <span class="k">def</span> <span class="nf">check_remote_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">          </span><span class="sd">"""</span>
<span class="sd">          This method checks if there are any indexers that need to be updated. It is useful for maintaining the freshness of the data.</span>
<span class="sd">          </span>
<span class="sd">          :returns: True if there are new indices and they are added to the indices attribute of the class. Otherwise, it returns False.</span>

<span class="sd">          :example:</span>

<span class="sd">          &gt;&gt;&gt; instance = Inchworm()</span>
<span class="sd">          &gt;&gt;&gt; has_updates = instance.check_for_updates()</span>
<span class="sd">          """</span>
          <span class="n">remote_indexers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_remote_indexers</span><span class="p">()</span>
          <span class="k">if</span> <span class="n">remote_indexers</span><span class="p">:</span>
              <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexers</span><span class="p">:</span>
                  <span class="n">new_indices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">remote_indexers</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indexers</span><span class="p">)</span>
                  <span class="k">if</span> <span class="ow">not</span> <span class="n">new_indices</span><span class="p">:</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">indexers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_indices</span><span class="p">)</span>
                      <span class="k">return</span> <span class="kc">True</span>
                  <span class="k">return</span> <span class="kc">False</span>
              <span class="k">else</span><span class="p">:</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">indexers</span> <span class="o">=</span> <span class="n">remote_indexers</span>
                  <span class="k">return</span> <span class="kc">True</span></div>

              
<div class="viewcode-block" id="WarcIndexer.get_remote_indexers">
<a class="viewcode-back" href="../References/Mycelium/Crawler.html#Crawler.WarcIndexer.get_remote_indexers">[docs]</a>
  <span class="k">def</span> <span class="nf">get_remote_indexers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">          </span><span class="sd">"""</span>
<span class="sd">          This method checks if there are any indexers to update and writes the updated indices to a JSON file. This provides a persistent record of the indices and their updates.</span>

<span class="sd">          :returns: A list of indexers if the request is successful. Otherwise, it returns None.</span>

<span class="sd">          :example:</span>

<span class="sd">          &gt;&gt;&gt; instance = Inchworm()</span>
<span class="sd">          &gt;&gt;&gt; indices = instance.get_remote_indexers()</span>
<span class="sd">          """</span>
          <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indexer_url</span><span class="p">)</span>
          <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
              <span class="k">return</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="s2">"id"</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()]</span>
          <span class="k">else</span><span class="p">:</span>
              <span class="k">raise</span> <span class="s2">"Did not get any indices from Common Crawl"</span></div>


<div class="viewcode-block" id="WarcIndexer.get_local_indexers">
<a class="viewcode-back" href="../References/Mycelium/Crawler.html#Crawler.WarcIndexer.get_local_indexers">[docs]</a>
  <span class="k">def</span> <span class="nf">get_local_indexers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">'indices.json'</span><span class="p">):</span>
<span class="w">          </span><span class="sd">"""</span>
<span class="sd">          This method fetches a list of indexers that are currently available in the Common Crawl index. It is useful for understanding the scope of data available for crawling. The filename parameter is optional and defaults to ‘indices.json’.</span>

<span class="sd">          :param filename: The name of the file to which the updated indices are appended.</span>
<span class="sd">          :returns: None</span>

<span class="sd">          :example:</span>

<span class="sd">          &gt;&gt;&gt; instance = Inchworm()</span>
<span class="sd">          &gt;&gt;&gt; instance.get_local_indexers('updated_indices.json')</span>
<span class="sd">          """</span>
          <span class="k">try</span><span class="p">:</span>
              <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">indexers</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
          <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">indexers</span> <span class="o">=</span> <span class="p">{}</span></div>


<div class="viewcode-block" id="WarcIndexer.update_indexers">
<a class="viewcode-back" href="../References/Mycelium/Crawler.html#Crawler.WarcIndexer.update_indexers">[docs]</a>
  <span class="k">def</span> <span class="nf">update_indexers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">'indices.json'</span><span class="p">):</span>
<span class="w">          </span><span class="sd">"""</span>
<span class="sd">          This method is responsible for updating the indexers. It ensures that the indexers are up-to-date with the latest data from the Common Crawl.</span>

<span class="sd">          :param filename: The name of the file to which the updated indices are appended.</span>
<span class="sd">          :returns: None</span>

<span class="sd">          :example:</span>

<span class="sd">          &gt;&gt;&gt; instance = Inchworm()</span>
<span class="sd">          &gt;&gt;&gt; instance.update_indexers('updated_indices.json')</span>
<span class="sd">          """</span>
          <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_for_updates</span><span class="p">():</span>
              <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">'w+'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                  <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indexers</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="WarcHandler">
<a class="viewcode-back" href="../References/Mycelium/Crawler.html#Crawler.WarcHandler">[docs]</a>
<span class="k">class</span> <span class="nc">WarcHandler</span><span class="p">:</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">warc_urls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_warc_urls</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">local_storage_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">'data'</span><span class="p">)</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_storage_path</span><span class="p">):</span>
          <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_storage_path</span><span class="p">)</span>

<div class="viewcode-block" id="WarcHandler.get_warc_url">
<a class="viewcode-back" href="../References/Mycelium/Crawler.html#Crawler.WarcHandler.get_warc_url">[docs]</a>
  <span class="k">def</span> <span class="nf">get_warc_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">remote_warc_url</span><span class="p">):</span>
<span class="w">          </span><span class="sd">"""</span>
<span class="sd">          This method returns a dictionary where the keys are the indices and the values are the lists of WARC URLs for each index. This provides a comprehensive view of the data available for each index.</span>
<span class="sd">          </span>
<span class="sd">          :param index: The index for which to retrieve the WARC URLs.</span>
<span class="sd">          :returns: A list of WARC URLs for the given index. If the request fails, it returns None.</span>

<span class="sd">          :example:</span>

<span class="sd">          &gt;&gt;&gt; index = 0</span>
<span class="sd">          &gt;&gt;&gt; res = instance.get_warc_urls(index)</span>
<span class="sd">          """</span>
          <span class="n">local_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_storage_path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">remote_warc_url</span><span class="p">))</span>
          <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_file_path</span><span class="p">):</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">,</span> <span class="n">remote_warc_url</span><span class="p">,</span> <span class="n">local_file_path</span><span class="p">)</span>
          <span class="k">return</span> <span class="n">local_file_path</span></div>


<div class="viewcode-block" id="WarcHandler.get_random_html">
<a class="viewcode-back" href="../References/Mycelium/Crawler.html#Crawler.WarcHandler.get_random_html">[docs]</a>
  <span class="k">def</span> <span class="nf">get_random_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">          </span><span class="sd">"""</span>
<span class="sd">          This method retrieves the HTML content from a random WARC file. This can be useful for testing or exploratory analysis. If the request fails, it returns None to handle the failure gracefully.</span>
<span class="sd">          </span>
<span class="sd">          :returns: HTML content from a random WARC file. If the request fails, it returns None.</span>

<span class="sd">          :example:</span>

<span class="sd">          &gt;&gt;&gt; res = instance.get_random_html()</span>
<span class="sd">          """</span>
          <span class="n">random_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">warc_urls</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
          <span class="n">random_url</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">warc_urls</span><span class="p">[</span><span class="n">random_index</span><span class="p">])</span>
          <span class="k">try</span><span class="p">:</span>
              <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_html_from_warc</span><span class="p">(</span><span class="n">random_url</span><span class="p">)</span>
          <span class="k">except</span><span class="p">:</span>
              <span class="k">return</span> <span class="kc">None</span></div>

          
<div class="viewcode-block" id="WarcHandler.get_html_from_warc">
<a class="viewcode-back" href="../References/Mycelium/Crawler.html#Crawler.WarcHandler.get_html_from_warc">[docs]</a>
  <span class="k">def</span> <span class="nf">get_html_from_warc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">warc_url</span><span class="p">):</span>
<span class="w">          </span><span class="sd">"""</span>
<span class="sd">          This method fetches the HTML content of a WARC file. This is a crucial step in the data extraction process, as it allows for the parsing and analysis of the web page content.</span>
<span class="sd">          </span>
<span class="sd">          :returns: HTML content of a WARC file. If the request fails, it returns None.</span>

<span class="sd">          :example:</span>

<span class="sd">          &gt;&gt;&gt; res = instance.get_warc_html()</span>
<span class="sd">          """</span>
          <span class="c1"># with open(file_path, 'rb') as stream:</span>
          <span class="c1">#     for record in ArchiveIterator(stream):</span>
          <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">warc_url</span><span class="p">)</span>
          <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span></div>

      
      
          <span class="c1"># def crawl(self):</span>
          <span class="c1">#     indices = self.list_common_crawl_indices()</span>
          <span class="c1">#     for index in indices:</span>
          <span class="c1">#         local_file_path = self.download_and_store_locally(index)</span>
          <span class="c1">#         self.process_warc_file(local_file_path)</span>
      
<div class="viewcode-block" id="WarcHandler.get_warc_urls">
<a class="viewcode-back" href="../References/Mycelium/Crawler.html#Crawler.WarcHandler.get_warc_urls">[docs]</a>
  <span class="k">def</span> <span class="nf">get_warc_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indexer</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Returns a list of indices currently available in the Common Crawl index.</span>

<span class="sd">        :returns: A list of indices if the request is successful. Otherwise, it returns None.</span>

<span class="sd">        :example:</span>

<span class="sd">        &gt;&gt;&gt; instance = Inchworm()</span>
<span class="sd">        &gt;&gt;&gt; indices = instance.get_indices()</span>
<span class="sd">        """</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">,</span> <span class="n">Prefix</span><span class="o">=</span><span class="sa">f</span><span class="s1">'cc-index/collections/</span><span class="si">{</span><span class="n">indexer</span><span class="si">}</span><span class="s1">/indexes/'</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s1">'Key'</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s1">'Contents'</span><span class="p">]]</span></div>
</div>

</pre></div>

          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright CONFIDENTIAL - Do Not Distribute. Copyright will be enforced..
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>