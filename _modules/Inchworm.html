<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>Inchworm &#8212; MYCELIUM  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=83e35b93" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css?v=79c92029" />
    <link rel="stylesheet" type="text/css" href="../_static/_style.css?v=a28cf678" />
    <link rel="stylesheet" type="text/css" href="../_static/_style.css?v=a28cf678" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=white data-md-color-accent=black>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#_modules/Inchworm" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="MYCELIUM  documentation"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">MYCELIUM</span>
          <span class="md-header-nav__topic"> Inchworm </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder=""Search""
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">MYCELIUM  documentation</a></li>
          <li class="md-tabs__item"><a href="index.html" class="md-tabs__link">Module code</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="MYCELIUM documentation" class="md-nav__button md-logo">
      
        <img src="../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="MYCELIUM documentation">MYCELIUM</a>
  </label>
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">INTRODUCTION</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../Guide/purpose.html" class="md-nav__link">1. Statement of Purpose</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../Guide/guidelines.html" class="md-nav__link">2. Rules and Procedure</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../Guide/chain-of-command.html" class="md-nav__link">3. Chain of Command</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">GUIDE</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../Guide/ci-cd.html" class="md-nav__link">1. CI-CD Procedures</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../Guide/kubeflow.html" class="md-nav__link">2. Getting Started with Kubeflow</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../Guide/dashboard.html" class="md-nav__link">3. Platform Introduction Tutorial</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">EXAMPLES</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../Examples/notebooks.html" class="md-nav__link">1. Create a Kubeflow Notebook</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../Examples/katib.html" class="md-nav__link">2. Optimize Parameters</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../Examples/tensorboards.html" class="md-nav__link">3. Visualize Train and Test Results</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../Examples/plot-overview.html" class="md-nav__link">4. Plotting</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">REFERENCES</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../References/Mycelium.html" class="md-nav__link">Mycelium.py</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">database/</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../References/Mycelium/Inchworm.html" class="md-nav__link">Inchworm.py</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../References/Mycelium/Tree.html" class="md-nav__link">Tree.py</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../References/Mycelium/Branch.html" class="md-nav__link">Branch.py</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../References/Mycelium/Crawler.html" class="md-nav__link">Crawler.py</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">models/</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../References/Mycelium/Hyphae.html" class="md-nav__link">Hyphae.py</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../References/Mycelium/LLAMA.html" class="md-nav__link">LLAMA.py</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../References/Mycelium/Psilocybin.html" class="md-nav__link">Psilocybin.py</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">analytics/</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../References/Mycelium/Plot.html" class="md-nav__link">Plot.py</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../References/Mycelium/Cap.html" class="md-nav__link">Cap.py</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
  <ul class="md-nav__list" data-md-scrollfix="">
    

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <h1 id="modules-inchworm--page-root">Source code for Inchworm</h1><div class="highlight"><pre>
<span></span><span class="sd">"""</span>
<span class="sd">	Inchworm is a web crawler that traverses web pages in a breadth-first manner up to a specified depth.</span>
<span class="sd"> </span>
<span class="sd">	It stores the nodes (URLs) and edges (links between URLs) it encounters.</span>
<span class="sd"> </span>
<span class="sd">"""</span>

<span class="c1"># Standard library imports</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Lock</span>
<span class="kn">import</span> <span class="nn">traceback</span>

<span class="c1"># Third-party imports</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span><span class="p">,</span> <span class="n">PageElement</span><span class="p">,</span> <span class="n">Tag</span><span class="p">,</span> <span class="n">NavigableString</span><span class="p">,</span> <span class="n">Comment</span><span class="p">,</span> <span class="n">Stylesheet</span><span class="p">,</span> <span class="n">Script</span><span class="p">,</span> <span class="n">TemplateString</span><span class="p">,</span> <span class="n">CData</span><span class="p">,</span> <span class="n">ProcessingInstruction</span><span class="p">,</span> <span class="n">Declaration</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">;</span> <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Local application imports</span>
<span class="kn">from</span> <span class="nn">mycelium.utils</span> <span class="kn">import</span> <span class="n">performance</span>

  
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/v1/dom-tree'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">'POST'</span><span class="p">])</span>
<span class="nd">@performance</span><span class="o">.</span><span class="n">timeit</span>
<span class="k">def</span> <span class="nf">parse_embed_n_store_pages</span><span class="p">():</span>
<span class="w">	</span><span class="sd">"""Endpoint for a Mycelium data scrape/search job.</span>
<span class="sd">		</span>
<span class="sd">		This method </span>
<span class="sd">  		1. accepts a list of URLs, scrapes their content in parallel, and stores the parsed HTML chunks in a graph database. </span>
<span class="sd">		2. If the HTML content doesn't exist, it's scraped and indexed, creating a tree.</span>
<span class="sd">		3.The nodes and edges are saved to CSV files. </span>
<span class="sd">		</span>
<span class="sd">      	Note: The method is multithreaded, so the order of URLs is not preserved. Only one URL is parsed at a time.</span>
<span class="sd">  	</span>
<span class="sd">		:data:</span>
<span class="sd">  </span>
<span class="sd">			:urls: The list of urls to crawl.</span>
<span class="sd">			:embed: A boolean indicating whether or not to embed the data.</span>
<span class="sd">			:num_threads: The number of threads to use.</span>
<span class="sd">			:max_depth: The maximum depth to index urls.</span>
<span class="sd">		</span>
<span class="sd">		:example:</span>
<span class="sd">		</span>
<span class="sd">			&gt;&gt;&gt; mc.traverse(urls)</span>
<span class="sd">		</span>
<span class="sd">	"""</span>

	<span class="k">try</span><span class="p">:</span>
		<span class="c1"># Retrieve the JSON payload from the request</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
		
		<span class="n">root_urls</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"urls"</span><span class="p">)</span>
		<span class="n">urls</span> <span class="o">=</span> <span class="n">urls</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">root_urls</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">root_urls</span><span class="p">]</span>
  
		<span class="c1"># TODO: (low) implement - move to nodulets (you don't interact with the tree/graph directly)</span>
		<span class="c1"># self.node = get_node -&gt; {"id": _id, "depth": 0, "message_queue": [], "finished_processing": False}</span>
		<span class="c1"># self.branch = Branch.VectorDBLet(data, meta) </span>
		
		<span class="c1"># branch = Branch(data, meta) # tree</span>
		<span class="n">worm</span> <span class="o">=</span> <span class="n">Inchworm</span><span class="o">.</span><span class="n">Inchworm</span><span class="p">(</span><span class="n">root_urls</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"recursive"</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
  
		<span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
			<span class="s2">"status"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
			<span class="s2">"results"</span><span class="p">:</span> <span class="n">worm</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span>
		<span class="p">})</span>
	<span class="k">except</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">"traceback"</span><span class="p">:</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">(),</span> <span class="s2">"status"</span><span class="p">:</span> <span class="s2">"error"</span><span class="p">})</span>
 

<div class="viewcode-block" id="Inchworm">
<a class="viewcode-back" href="../References/Mycelium/Inchworm.html#Inchworm.Inchworm">[docs]</a>
<span class="k">class</span> <span class="nc">Inchworm</span><span class="p">:</span>
    
	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">		</span><span class="sd">"""</span>
<span class="sd">		Initialize the Inchworm with a URL, maximum depth, current depth, and number of threads.</span>

<span class="sd">		Args:</span>
<span class="sd">			url (str): The URL to start crawling from.</span>
<span class="sd">			max_depth (int, optional): The maximum depth to crawl. Defaults to 3.</span>
<span class="sd">			depth (int, optional): The current depth of the crawl. Defaults to 1.</span>
<span class="sd">			num_threads (int, optional): The number of threads to use for the crawl. Defaults to 10.</span>

<span class="sd">		The Inchworm class represents a web crawler that starts from a given URL and crawls to a specified maximum depth. The number of threads determines how many pages are crawled simultaneously.</span>
<span class="sd">  </span>
<span class="sd">		"""</span>
  
		<span class="n">url</span> <span class="o">=</span> <span class="n">url</span> <span class="k">if</span> <span class="n">url</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'/'</span> <span class="k">else</span> <span class="n">url</span> <span class="o">+</span> <span class="s1">'/'</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
		<span class="c1"># self.filter = FilterElements()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span> <span class="n">num_threads</span><span class="o">=</span><span class="n">num_threads</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">save_tree_to_csv</span><span class="p">()</span>
  

<div class="viewcode-block" id="Inchworm.url_to_bs4">
<a class="viewcode-back" href="../References/Mycelium/Inchworm.html#Inchworm.Inchworm.url_to_bs4">[docs]</a>
	<span class="nd">@staticmethod</span>
	<span class="k">def</span> <span class="nf">url_to_bs4</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BeautifulSoup</span><span class="p">:</span>
<span class="w">		</span><span class="sd">"""</span>
<span class="sd">		Initialize the Inchworm with a starting URL, maximum depth to crawl, current depth, and number of threads.</span>

<span class="sd">		Args:</span>
<span class="sd">			url (str): The starting URL for the web crawler.</span>

<span class="sd">		"""</span>
        
		<span class="k">try</span><span class="p">:</span>
      		<span class="c1"># Generate HTML """</span>
			<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s1">'lxml'</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"https://"</span><span class="p">,</span> <span class="s2">"http://"</span><span class="p">))</span>
				<span class="k">return</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s1">'lxml'</span><span class="p">)</span>
			<span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">:</span>
				<span class="k">return</span></div>



<div class="viewcode-block" id="Inchworm.clean_url">
<a class="viewcode-back" href="../References/Mycelium/Inchworm.html#Inchworm.Inchworm.clean_url">[docs]</a>
	<span class="k">def</span> <span class="nf">clean_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
		<span class="c1"># Reduce URL Strong Size for Storing &amp; Consistency """</span>
		<span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"https://"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"http://"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"www."</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span></div>



<div class="viewcode-block" id="Inchworm.save_tree_to_csv">
<a class="viewcode-back" href="../References/Mycelium/Inchworm.html#Inchworm.Inchworm.save_tree_to_csv">[docs]</a>
	<span class="k">def</span> <span class="nf">save_tree_to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_path</span><span class="o">=</span><span class="s2">"tests/_outputs/"</span><span class="p">):</span>
<span class="w">		</span><span class="sd">"""</span>
<span class="sd">		This method saves the nodes and edges to csv files.</span>

<span class="sd">		:data_path: The path to the data folder.</span>

<span class="sd">		:example:</span>

<span class="sd">			&gt;&gt;&gt; mc.save_tree_to_csv()</span>
<span class="sd">   </span>
<span class="sd">		"""</span>

		<span class="k">def</span> <span class="nf">normalize_and_sort</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">'importance'</span><span class="p">):</span>
<span class="w">			</span><span class="sd">"""</span>
<span class="sd">			Normalize and sort a DataFrame based on a specified column.</span>

<span class="sd">			This method takes a DataFrame and a column name, normalizes the values in the column, </span>
<span class="sd">			and sorts the DataFrame based on the normalized values.</span>

<span class="sd">			Args:</span>
<span class="sd">				df (pandas.DataFrame): The DataFrame to normalize and sort.</span>
<span class="sd">				column (str, optional): The column to normalize and sort by. Defaults to 'importance'.</span>

<span class="sd">			Returns:</span>
<span class="sd">				pandas.DataFrame: The normalized and sorted DataFrame.</span>
<span class="sd">    </span>
<span class="sd">			"""</span>
			<span class="o">...</span>
			<span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
			<span class="n">min_value</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
			<span class="n">max_value</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">max_value</span> <span class="o">!=</span> <span class="n">min_value</span><span class="p">:</span>
				<span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">-</span> <span class="n">min_value</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_value</span> <span class="o">-</span> <span class="n">min_value</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span>
			<span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">df</span>


		<span class="n">nodes_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([(</span><span class="n">url</span><span class="p">,</span> <span class="n">val</span><span class="p">[</span><span class="s1">'depth'</span><span class="p">],</span> <span class="n">val</span><span class="p">[</span><span class="s2">"count"</span><span class="p">])</span> <span class="k">for</span> <span class="n">url</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'url'</span><span class="p">,</span> <span class="s1">'depth'</span><span class="p">,</span> <span class="s1">'importance'</span><span class="p">])</span>
		<span class="n">edges_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">),</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'source'</span><span class="p">,</span> <span class="s1">'target'</span><span class="p">,</span> <span class="s1">'importance'</span><span class="p">])</span>

		<span class="c1"># Calculate node and edge importance</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">normalize_and_sort</span><span class="p">(</span><span class="n">nodes_df</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="n">normalize_and_sort</span><span class="p">(</span><span class="n">edges_df</span><span class="p">)</span>
  
		<span class="c1"># Create a mapping from url to index</span>
		<span class="n">url_to_index</span> <span class="o">=</span> <span class="p">{</span><span class="n">url</span><span class="p">:</span> <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">url</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">'url'</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

		<span class="c1"># Replace 'source' and 'target' columns with corresponding indices</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="s1">'source'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="s1">'source'</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">url_to_index</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="s1">'target'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="s1">'target'</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">url_to_index</span><span class="p">)</span>

		<span class="c1"># Save nodes and edges to CSV files</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s1">nodes.csv'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s1">edges.csv'</span><span class="p">)</span></div>

  

<div class="viewcode-block" id="Inchworm.add_child">
<a class="viewcode-back" href="../References/Mycelium/Inchworm.html#Inchworm.Inchworm.add_child">[docs]</a>
	<span class="nd">@performance</span><span class="o">.</span><span class="n">multithread</span>
	<span class="k">def</span> <span class="nf">add_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">		</span><span class="sd">"""</span>
<span class="sd">		Recursively scrapes HTML content from a webpage and identifies linked pages.</span>

<span class="sd">		This method fetches the HTML content of a webpage, parses it to extract relevant information, and identifies all the linked pages within it. If the recursive option is enabled, it will also scrape the linked pages to a specified depth.</span>
<span class="sd">  </span>
<span class="sd">		"""</span>
     
		<span class="n">child</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clean_url</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
  
		<span class="bp">self</span><span class="o">.</span><span class="n">update_node</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">max_depth</span><span class="p">:</span>
			<span class="k">return</span>

		<span class="n">HTML</span> <span class="o">=</span> <span class="n">Inchworm</span><span class="o">.</span><span class="n">url_to_bs4</span><span class="p">(</span><span class="sa">f</span><span class="s2">"https://</span><span class="si">{</span><span class="n">child</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

		<span class="k">def</span> <span class="nf">process_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
<span class="w">			</span><span class="sd">"""</span>
<span class="sd">			Process a link element.</span>

<span class="sd">			This method takes a link element, extracts its href attribute, and adds it to the nodes dictionary. </span>
<span class="sd">			It also updates the edges dictionary to reflect the hierarchical relationship between the parent and child nodes.</span>

<span class="sd">			Args:</span>
<span class="sd">				a (bs4.element.Tag): The link element to process.</span>

<span class="sd">			Example:</span>
<span class="sd">				with ThreadPoolExecutor(max_workers=num_threads) as executor:</span>
<span class="sd">					futures = [executor.submit(self.process_link, a) for a in HTML.find_all('a', href=True)]</span>
<span class="sd">					for future in futures:</span>
<span class="sd">						future.result()</span>
<span class="sd">	</span>
<span class="sd">			"""</span>
	
			<span class="n">href</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'href'</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">href</span> <span class="ow">and</span> <span class="n">href</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'http'</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">href</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'.png'</span><span class="p">,</span> <span class="s1">'.jpg'</span><span class="p">,</span> <span class="s1">'.jpeg'</span><span class="p">,</span> <span class="s1">'.gif'</span><span class="p">]):</span>

				<span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span><span class="c1"># do not duplicate nodes/edges that are already crawled</span>

					<span class="n">new_parent</span> <span class="o">=</span> <span class="n">child</span>
					<span class="n">new_child</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clean_url</span><span class="p">(</span><span class="n">href</span><span class="p">)</span>
					<span class="k">if</span> <span class="ow">not</span> <span class="n">new_child</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'/'</span><span class="p">:</span>
						<span class="n">new_child</span> <span class="o">=</span> <span class="n">new_child</span> <span class="o">+</span> <span class="s1">'/'</span>
	
					<span class="n">source</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">new_parent</span><span class="p">,</span> <span class="n">new_child</span>

					<span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="n">target</span><span class="p">:</span> <span class="c1"># calling itself (need to not have children)</span>
						<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
							<span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">source</span><span class="p">,</span> <span class="n">source</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">source</span><span class="p">,</span> <span class="n">source</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>
					<span class="k">elif</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>

				<span class="bp">self</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">)</span>

		<span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">num_threads</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
			<span class="k">return</span> <span class="p">[</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">process_link</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">HTML</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span></div>

  
  
<div class="viewcode-block" id="Inchworm.update_node">
<a class="viewcode-back" href="../References/Mycelium/Inchworm.html#Inchworm.Inchworm.update_node">[docs]</a>
	<span class="k">def</span> <span class="nf">update_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
<span class="w">		</span><span class="sd">"""</span>
<span class="sd">		Update the node with the given URL and depth.</span>

<span class="sd">		This method updates the nodes dictionary with the given URL and depth. </span>
<span class="sd">		If the URL is already in the dictionary, it updates the depth if the new depth is less than the existing one.</span>

<span class="sd">		Args:</span>
<span class="sd">			url (str): The URL of the node to update.</span>
<span class="sd">			depth (int): The depth of the node.</span>

<span class="sd">		"""</span>

		<span class="k">if</span> <span class="n">url</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">url</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"depth"</span><span class="p">:</span> <span class="n">depth</span><span class="p">,</span> <span class="s2">"count"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">url</span><span class="p">][</span><span class="s2">"count"</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">url</span><span class="p">][</span><span class="s2">"depth"</span><span class="p">]</span> <span class="o">=</span> <span class="n">depth</span></div>



<div class="viewcode-block" id="Inchworm.parse_embed_n_store_page">
<a class="viewcode-back" href="../References/Mycelium/Inchworm.html#Inchworm.Inchworm.parse_embed_n_store_page">[docs]</a>
	<span class="k">def</span> <span class="nf">parse_embed_n_store_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">,</span> <span class="n">embed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">recursive</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
<span class="w">		</span><span class="sd">"""</span>
<span class="sd">		Logical parsing of the HTML elements and storing at each step, optionally embedding the data.</span>

<span class="sd">		:param url: The url to be scraped.</span>
<span class="sd">		:param embed: A boolean indicating whether or not to embed the data.</span>
<span class="sd">		:param recursive: An indicating how deep to scrape recursively.</span>
<span class="sd">		"""</span>
  
		<span class="n">child</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clean_url</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
  
		<span class="bp">self</span><span class="o">.</span><span class="n">update_node</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">max_depth</span><span class="p">:</span>
			<span class="k">return</span>

		<span class="n">HTML</span> <span class="o">=</span> <span class="n">Inchworm</span><span class="o">.</span><span class="n">url_to_bs4</span><span class="p">(</span><span class="sa">f</span><span class="s2">"https://</span><span class="si">{</span><span class="n">child</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

		<span class="c1"># TODO add to DB</span>
  
		<span class="c1"># for each page - chunk it, embed it, and store it</span>
		<span class="n">chunk_embeddings</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>	
			<span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_elements</span><span class="p">,</span> <span class="n">HTML</span><span class="p">,</span> <span class="n">chunk_embeddings</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">embed</span><span class="p">,</span> <span class="n">recursive</span><span class="p">)</span></div>


		<span class="c1"># if embed:  # now put all of the pieces together</span>
		<span class="c1"># 	page_embedding = Mycelium.fit(chunk_embeddings)  # put a bow on it</span>


<div class="viewcode-block" id="Inchworm.process_elements">
<a class="viewcode-back" href="../References/Mycelium/Inchworm.html#Inchworm.Inchworm.process_elements">[docs]</a>
	<span class="k">def</span> <span class="nf">process_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">HTML</span><span class="p">,</span> <span class="n">chunk_embeddings</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">embed</span><span class="p">,</span> <span class="n">recursive</span><span class="p">):</span>
	
		<span class="n">tag_specs</span> <span class="o">=</span> <span class="p">[</span>
			<span class="p">{</span><span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"div"</span><span class="p">,</span> <span class="s2">"attrs"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"class"</span><span class="p">:</span> <span class="s2">"book-pdf-content"</span><span class="p">}},</span>
			<span class="p">{</span><span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"main"</span><span class="p">,</span> <span class="s2">"attrs"</span><span class="p">:</span> <span class="p">{}},</span>
			<span class="p">{</span><span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"body"</span><span class="p">,</span> <span class="s2">"attrs"</span><span class="p">:</span> <span class="p">{}}</span>
		<span class="p">]</span>

		<span class="c1"># Try to find and extract a node matching each tag specification in order</span>
		<span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">tag_specs</span><span class="p">:</span>
			<span class="n">node</span> <span class="o">=</span> <span class="n">HTML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="s2">"tag"</span><span class="p">],</span> <span class="n">spec</span><span class="p">[</span><span class="s2">"attrs"</span><span class="p">])</span>
			<span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">node</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>

		<span class="k">def</span> <span class="nf">process_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">):</span>
<span class="w">			</span><span class="sd">"""</span>
<span class="sd">			Process an HTML element.</span>

<span class="sd">			This method takes an HTML element, extracts its content, and processes it based on its type (text, image, form, etc.). </span>
<span class="sd">			It also updates the nodes and edges dictionaries to reflect the hierarchical relationship between the parent and child nodes.</span>

<span class="sd">			Args:</span>
<span class="sd">				chunk (bs4.element.Tag): The HTML element to process.</span>

<span class="sd">			Usage:</span>
<span class="sd">				with ThreadPoolExecutor(max_workers=num_threads) as executor:</span>
<span class="sd">					futures = []</span>
<span class="sd">					for tag in ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'li']:</span>
<span class="sd">						elements = HTML.find_all(tag)</span>
<span class="sd">						futures.extend([executor.submit(self.process_element, element) for element in elements])</span>
<span class="sd">					for future in futures:</span>
<span class="sd">						future.result()</span>
<span class="sd">      </span>
<span class="sd">			"""</span>

			<span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"script"</span><span class="p">,</span> <span class="s2">"style"</span><span class="p">]:</span>
				<span class="k">return</span>

			<span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"a"</span><span class="p">:</span>
				<span class="n">LinkElement</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recursive</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">)</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>

			<span class="k">elif</span> <span class="n">chunk</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"h1"</span><span class="p">,</span> <span class="s2">"ul"</span><span class="p">,</span> <span class="s2">"li"</span><span class="p">,</span> <span class="s2">"ol"</span><span class="p">,</span> <span class="s2">"p"</span><span class="p">]:</span>
				<span class="n">TextElement</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">embed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>

			<span class="k">elif</span> <span class="n">chunk</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"img"</span><span class="p">:</span>
				<span class="n">ImageElement</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">)</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>

			<span class="k">elif</span> <span class="n">chunk</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"form"</span><span class="p">:</span>
				<span class="n">FormElement</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">)</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>

			<span class="k">elif</span> <span class="n">chunk</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"table"</span><span class="p">:</span>
				<span class="n">TableElement</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">)</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>

			<span class="k">else</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"unexpected html element. do something."</span><span class="p">)</span></div>
</div>

 
<div class="viewcode-block" id="FilterElements">
<a class="viewcode-back" href="../References/Mycelium/Inchworm.html#Inchworm.FilterElements">[docs]</a>
<span class="k">class</span> <span class="nc">FilterElements</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Filtering OUT tags that we are not interested in (keep ones we are interested in)</span>
<span class="sd">        </span>
<span class="sd">        :param *args:</span>
<span class="sd">        :param **kwds:</span>
<span class="sd">        </span>
<span class="sd">        :example:</span>
<span class="sd">        </span>
<span class="sd">            &gt;&gt;&gt; filter = Filter()</span>
<span class="sd">            &gt;&gt;&gt; filter.by_task(node)</span>
<span class="sd">        """</span>
        
        <span class="c1"># filter elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_task</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">'div'</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">has_attr</span><span class="p">(</span><span class="s1">'class'</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"task"</span><span class="p">,</span> <span class="s2">"task0"</span><span class="p">,</span> <span class="s2">"task1"</span><span class="p">,</span> <span class="s2">"task2"</span><span class="p">,</span> <span class="s2">"task3"</span><span class="p">,</span> <span class="s2">"task4"</span><span class="p">,</span> <span class="s2">"task5"</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">node</span><span class="p">[</span><span class="s2">"class"</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_section</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">'section'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_navigable_string</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="n">NavigableString</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_paragraph</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="s2">"p"</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"class"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span> <span class="ow">or</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"p"</span> <span class="ow">or</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"div"</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">==</span> <span class="n">NavigableString</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="c1"># TODO be more robust than this; we can accidentally match a `p` mid-word.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_steps</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="s2">"steps"</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"class"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_heading</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"h1"</span><span class="p">,</span> <span class="s2">"h2"</span><span class="p">,</span> <span class="s2">"h3"</span><span class="p">,</span> <span class="s2">"h4"</span><span class="p">,</span> <span class="s2">"h5"</span><span class="p">,</span> <span class="s2">"h6"</span><span class="p">,</span> <span class="s2">"h7"</span><span class="p">,</span> <span class="s2">"h8"</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">has_attr</span><span class="p">(</span><span class="s1">'class'</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">"title"</span> <span class="ow">in</span> <span class="n">node</span><span class="p">[</span><span class="s2">"class"</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_nestable_text</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">NavigableString</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">":"</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Tag</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_heading</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="ow">or</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">":"</span><span class="p">))</span> <span class="c1"># or node.text.istitle()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_span</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"span"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_a</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"a"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_strong</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"strong"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_leaf_span</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_span</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="n">NavigableString</span> <span class="k">for</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">contents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_unordered_list_item</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"li"</span> <span class="ow">and</span> <span class="p">[</span><span class="n">parent</span> <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">find_parents</span><span class="p">()</span> <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"ul"</span><span class="p">]]</span> <span class="ow">and</span> <span class="p">[</span><span class="n">parent</span> <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">find_parents</span><span class="p">()</span> <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"ul"</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"ul"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_ordered_list_item</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"li"</span> <span class="ow">and</span> <span class="p">[</span><span class="n">parent</span> <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">find_parents</span><span class="p">()</span> <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"ol"</span><span class="p">]]</span> <span class="ow">and</span> <span class="p">[</span><span class="n">parent</span> <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">find_parents</span><span class="p">()</span> <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"ol"</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"ol"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_ordered_list</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"ol"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_unordered_list</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"ul"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_example_code</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"pre"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_checkmark</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"img"</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">has_attr</span><span class="p">(</span><span class="s2">"alt"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">node</span><span class="p">[</span><span class="s2">"alt"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"check-mark.png"</span>

        <span class="c1"># unroll table - helps </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_table</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"table"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_table_row</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"tr"</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">"th"</span><span class="p">)</span> <span class="c1"># leave &lt;TH&gt; headers inside the &lt;TABLE&gt; node so that actual rows can see it in ancestry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_table_header</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"th"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_table_data_cell</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"td"</span>

        <span class="c1"># prevent spawning of children  (TODO how true is this assumption)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unrollable</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_banned_tag</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Tag</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">([</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">by_span</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">by_strong</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">by_a</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
        <span class="p">])</span>

        <span class="c1"># in some cases order matters...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">serial</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_banned_tag</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Tag</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">([</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">by_steps</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">by_ordered_list_item</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">by_table_data_cell</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
        <span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">by_banned_tag</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> 
            <span class="p">(</span><span class="n">Tag</span><span class="p">,</span> <span class="n">NavigableString</span><span class="p">))</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> 
            <span class="p">(</span><span class="n">Comment</span><span class="p">,</span> <span class="n">Stylesheet</span><span class="p">,</span> <span class="n">Script</span><span class="p">,</span> <span class="n">TemplateString</span><span class="p">,</span> <span class="n">CData</span><span class="p">,</span> <span class="n">ProcessingInstruction</span><span class="p">,</span> <span class="n">Declaration</span><span class="p">)</span>
        <span class="p">)</span>
            
        <span class="c1"># in some cases order doesn't matter... (e.g. if you want to check step 3, you don't need to check step 1 or 2)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nonserial</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_banned_tag</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">by_navigable_string</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="ow">or</span> \
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">bs4</span><span class="o">.</span><span class="n">Tag</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">([</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">by_task</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">by_section</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">by_paragraph</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">by_navigable_string</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">by_unordered_list_item</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">by_unordered_list</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">by_ordered_list</span><span class="p">(</span><span class="n">node</span><span class="p">),</span> <span class="c1"># Putting this in the ordered section causes to put SerialConcept above &lt;OL&gt; which is unnecessary duplication of SerialConcept</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">by_example_code</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">by_checkmark</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">by_table</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">by_table_row</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
        <span class="p">])</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nonserial</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">descendants</span><span class="p">))</span>
        

<div class="viewcode-block" id="FilterElements.any">
<a class="viewcode-back" href="../References/Mycelium/Inchworm.html#Inchworm.FilterElements.any">[docs]</a>
    <span class="k">def</span> <span class="nf">any</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">PageElement</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Strip out empty nodes and nodes that are not serial or nonserial.</span>

<span class="sd">        :param node: BeautifulSoup node</span>
<span class="sd">        </span>
<span class="sd">        """</span>
        
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="n">node</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">serial</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">nonserial</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="p">)</span></div>
</div>




<div class="viewcode-block" id="Element">
<a class="viewcode-back" href="../References/Mycelium/Inchworm.html#Inchworm.Element">[docs]</a>
<span class="k">class</span> <span class="nc">Element</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">	</span><span class="sd">"""</span>
<span class="sd">	Process a text element and its children recursively.</span>

<span class="sd">	This method takes a text element, extracts its string content, and adds it to the nodes dictionary. </span>
<span class="sd">	It also updates the edges dictionary to reflect the hierarchical relationship between the parent and child nodes.</span>
<span class="sd">	The process is repeated recursively for all children of the element. See the following classes for examples of how this would be used</span>
<span class="sd">	"""</span>
 
  
	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">lock</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">chunk</span> <span class="o">=</span> <span class="n">chunk</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">lock</span>

<div class="viewcode-block" id="Element.process">
<a class="viewcode-back" href="../References/Mycelium/Inchworm.html#Inchworm.Element.process">[docs]</a>
	<span class="nd">@abstractmethod</span>
	<span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">pass</span></div>
</div>



<div class="viewcode-block" id="LinkElement">
<a class="viewcode-back" href="../References/Mycelium/Inchworm.html#Inchworm.LinkElement">[docs]</a>
<span class="k">class</span> <span class="nc">LinkElement</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>
	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">lock</span><span class="p">,</span> <span class="n">recursive</span><span class="p">,</span> <span class="n">parse_embed_n_store_page</span><span class="p">):</span>
		<span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">lock</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">recursive</span> <span class="o">=</span> <span class="n">recursive</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">parse_embed_n_store_page</span> <span class="o">=</span> <span class="n">parse_embed_n_store_page</span>

<div class="viewcode-block" id="LinkElement.process">
<a class="viewcode-back" href="../References/Mycelium/Inchworm.html#Inchworm.LinkElement.process">[docs]</a>
	<span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
<span class="w">		</span><span class="sd">"""</span>
<span class="sd">		Process a link element.</span>

<span class="sd">		This method takes a link element, extracts the href attribute, and checks if it's a valid HTTP URL that does not</span>
<span class="sd">		end with an image extension. If the URL is valid, it's added to the edges dictionary, which keeps track of the</span>
<span class="sd">		connections between different URLs. If the URL is the same as the parent URL, it's considered a self-reference</span>
<span class="sd">		and is handled accordingly. After processing the URL, it's added as a child to the parent URL.</span>

<span class="sd">		Args:</span>
<span class="sd">			a (bs4.element.Tag): The link element to process.</span>

<span class="sd">		"""</span>
		<span class="n">href</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'href'</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">href</span> <span class="ow">and</span> <span class="n">href</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'http'</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">href</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'.png'</span><span class="p">,</span> <span class="s1">'.jpg'</span><span class="p">,</span> <span class="s1">'.jpeg'</span><span class="p">,</span> <span class="s1">'.gif'</span><span class="p">]):</span>

			<span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>  <span class="c1"># do not duplicate nodes/edges that are already crawled</span>

				<span class="n">new_parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">child</span>
				<span class="n">new_child</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clean_url</span><span class="p">(</span><span class="n">href</span><span class="p">)</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="n">new_child</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'/'</span><span class="p">:</span>
					<span class="n">new_child</span> <span class="o">=</span> <span class="n">new_child</span> <span class="o">+</span> <span class="s1">'/'</span>

				<span class="n">source</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">new_parent</span><span class="p">,</span> <span class="n">new_child</span>

				<span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="n">target</span><span class="p">:</span>  <span class="c1"># calling itself (need to not have children)</span>
					<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">source</span><span class="p">,</span> <span class="n">source</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">source</span><span class="p">,</span> <span class="n">source</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>
				<span class="k">elif</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>

			<span class="bp">self</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_depth</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="TextElement">
<a class="viewcode-back" href="../References/Mycelium/Inchworm.html#Inchworm.TextElement">[docs]</a>
<span class="k">class</span> <span class="nc">TextElement</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>
	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">lock</span><span class="p">,</span> <span class="n">chunk_embeddings</span><span class="p">,</span> <span class="n">embed</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
		<span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">lock</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">chunk_embeddings</span> <span class="o">=</span> <span class="n">chunk_embeddings</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">embed</span> <span class="o">=</span> <span class="n">embed</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

<div class="viewcode-block" id="TextElement.process_element">
<a class="viewcode-back" href="../References/Mycelium/Inchworm.html#Inchworm.TextElement.process_element">[docs]</a>
	<span class="k">def</span> <span class="nf">process_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  
<span class="w">		</span><span class="sd">"""</span>
<span class="sd">		Process a text element and its children recursively.</span>

<span class="sd">		This method takes a text element, extracts its string content, and adds it to the nodes dictionary. </span>
<span class="sd">		It also updates the edges dictionary to reflect the hierarchical relationship between the parent and child nodes.</span>
<span class="sd">		The process is repeated recursively for all children of the element.</span>

<span class="sd">		Args:</span>
<span class="sd">			element (bs4.element.Tag): The text element to process.</span>
<span class="sd">			parent (str, optional): The parent node of the element. Defaults to None.</span>

<span class="sd">		Example:</span>
<span class="sd">			with ThreadPoolExecutor(max_workers=num_threads) as executor:</span>
<span class="sd">				futures = []</span>
<span class="sd">				for tag in ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'li']:</span>
<span class="sd">					elements = HTML.find_all(tag)</span>
<span class="sd">					futures.extend([executor.submit(self.process_element, element) for element in elements])</span>
<span class="sd">				for future in futures:</span>
<span class="sd">					future.result()</span>
<span class="sd">     </span>
<span class="sd">		"""</span>

		<span class="n">text_content</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">string</span>
		<span class="k">if</span> <span class="n">text_content</span><span class="p">:</span>

			<span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>  <span class="c1"># do not duplicate nodes/edges that are already crawled</span>

				<span class="n">new_parent</span> <span class="o">=</span> <span class="n">parent</span>
				<span class="n">new_child</span> <span class="o">=</span> <span class="n">text_content</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>  <span class="c1"># Use the first 10 characters of the text as the node name</span>
				<span class="k">if</span> <span class="n">new_child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">new_child</span><span class="p">][</span><span class="s2">"count"</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">new_child</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"url"</span><span class="p">:</span> <span class="n">new_child</span><span class="p">,</span> <span class="s2">"depth"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"count"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

				<span class="k">if</span> <span class="n">new_parent</span><span class="p">:</span>
					<span class="n">source</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">new_parent</span><span class="p">,</span> <span class="n">new_child</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>

		<span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">process_element</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">new_child</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ImageElement">
<a class="viewcode-back" href="../References/Mycelium/Inchworm.html#Inchworm.ImageElement">[docs]</a>
<span class="k">class</span> <span class="nc">ImageElement</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>
<div class="viewcode-block" id="ImageElement.process">
<a class="viewcode-back" href="../References/Mycelium/Inchworm.html#Inchworm.ImageElement.process">[docs]</a>
	<span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">def</span> <span class="nf">process_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
<span class="w">			</span><span class="sd">"""</span>
<span class="sd">			Process an image element and its children recursively.</span>

<span class="sd">			This method takes an image element, extracts its source URL, and adds it to the nodes dictionary. </span>
<span class="sd">			It also updates the edges dictionary to reflect the hierarchical relationship between the parent and child nodes.</span>
<span class="sd">			The process is repeated recursively for all children of the element.</span>

<span class="sd">			Args:</span>
<span class="sd">				img (bs4.element.Tag): The image element to process.</span>

<span class="sd">			Example:</span>
<span class="sd">				with ThreadPoolExecutor(max_workers=num_threads) as executor:</span>
<span class="sd">					futures = [executor.submit(self.process_image, img) for img in HTML.find_all('img', src=True)]</span>
<span class="sd">					for future in futures:</span>
<span class="sd">						future.result()</span>
<span class="sd">      </span>
<span class="sd">			"""</span>
      
			<span class="n">src</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'src'</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">src</span> <span class="ow">and</span> <span class="n">src</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'http'</span><span class="p">)</span> <span class="ow">and</span> <span class="n">src</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s1">'.png'</span><span class="p">,</span> <span class="s1">'.jpg'</span><span class="p">,</span> <span class="s1">'.jpeg'</span><span class="p">,</span> <span class="s1">'.gif'</span><span class="p">)):</span>

				<span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>  <span class="c1"># do not duplicate nodes/edges that are already crawled</span>

					<span class="n">new_parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">child</span>
					<span class="n">new_child</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clean_url</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
					<span class="k">if</span> <span class="ow">not</span> <span class="n">new_child</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'/'</span><span class="p">:</span>
						<span class="n">new_child</span> <span class="o">=</span> <span class="n">new_child</span> <span class="o">+</span> <span class="s1">'/'</span>

					<span class="n">source</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">new_parent</span><span class="p">,</span> <span class="n">new_child</span>

					<span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="n">target</span><span class="p">:</span>  <span class="c1"># calling itself (need to not have children)</span>
						<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
							<span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">source</span><span class="p">,</span> <span class="n">source</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">source</span><span class="p">,</span> <span class="n">source</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>
					<span class="k">elif</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span></div>
</div>



<div class="viewcode-block" id="FormElement">
<a class="viewcode-back" href="../References/Mycelium/Inchworm.html#Inchworm.FormElement">[docs]</a>
<span class="k">class</span> <span class="nc">FormElement</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>
<div class="viewcode-block" id="FormElement.process_form">
<a class="viewcode-back" href="../References/Mycelium/Inchworm.html#Inchworm.FormElement.process_form">[docs]</a>
	<span class="k">def</span> <span class="nf">process_form</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
<span class="w">		</span><span class="sd">"""</span>
<span class="sd">		Process a form element and its children recursively.</span>

<span class="sd">		This method takes a form element, extracts its action URL, and adds it to the nodes dictionary. </span>
<span class="sd">		It also updates the edges dictionary to reflect the hierarchical relationship between the parent and child nodes.</span>
<span class="sd">		The process is repeated recursively for all children of the element.</span>

<span class="sd">		Args:</span>
<span class="sd">			form (bs4.element.Tag): The form element to process.</span>

<span class="sd">		Example:</span>
<span class="sd">			with ThreadPoolExecutor(max_workers=num_threads) as executor:</span>
<span class="sd">				futures = [executor.submit(self.process_form, form) for form in HTML.find_all('form', action=True)]</span>
<span class="sd">				for future in futures:</span>
<span class="sd">					future.result()</span>
<span class="sd">     </span>
<span class="sd">		"""</span>
		
		<span class="n">action</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'action'</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">action</span><span class="p">:</span>

			<span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>  <span class="c1"># do not duplicate nodes/edges that are already crawled</span>

				<span class="n">new_parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">child</span>
				<span class="n">new_child</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clean_url</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="n">new_child</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'/'</span><span class="p">:</span>
					<span class="n">new_child</span> <span class="o">=</span> <span class="n">new_child</span> <span class="o">+</span> <span class="s1">'/'</span>

				<span class="n">source</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">new_parent</span><span class="p">,</span> <span class="n">new_child</span>

				<span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="n">target</span><span class="p">:</span>  <span class="c1"># calling itself (need to not have children)</span>
					<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">source</span><span class="p">,</span> <span class="n">source</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">source</span><span class="p">,</span> <span class="n">source</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>
				<span class="k">elif</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span></div>
</div>



<div class="viewcode-block" id="TableElement">
<a class="viewcode-back" href="../References/Mycelium/Inchworm.html#Inchworm.TableElement">[docs]</a>
<span class="k">class</span> <span class="nc">TableElement</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>
<div class="viewcode-block" id="TableElement.process">
<a class="viewcode-back" href="../References/Mycelium/Inchworm.html#Inchworm.TableElement.process">[docs]</a>
	<span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">node_name</span> <span class="o">=</span> <span class="s1">'table'</span>  <span class="c1"># Use a generic name for table nodes</span>
		<span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">node_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_name</span><span class="p">][</span><span class="s2">"count"</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"url"</span><span class="p">:</span> <span class="n">node_name</span><span class="p">,</span> <span class="s2">"depth"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"count"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span></div>
</div>

</pre></div>

          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright CONFIDENTIAL - Do Not Distribute. Copyright will be enforced..
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>